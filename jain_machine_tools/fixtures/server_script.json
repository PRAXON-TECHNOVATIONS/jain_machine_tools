[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-12-03 13:37:27.164067",
  "module": "Jain Machine Tools",
  "name": "Purchase User Role see only approved suppliers",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Supplier",
  "script": "user = frappe.session.user\r\nhigh_roles = [\"Administrator\", \"System Manager\", \"Purchase Manager\", \"Purchase Master Manager\" ,\"Accounts Manager\"]\r\n\r\nuser_doc = frappe.get_doc(\"User\", user)\r\nuser_roles = [r.role for r in user_doc.get(\"roles\")]\r\nshow_all = False\r\nshow_approved_only = False\r\nfor role in user_roles:\r\n    if role in high_roles:\r\n        show_all = True\r\n        break\r\nif not show_all and \"Purchase User\" in user_roles:\r\n    show_approved_only = True\r\nif show_all:\r\n    conditions = \"\"\r\nelif show_approved_only:\r\n    conditions = \"workflow_state = 'Approved'\"\r\nelse:\r\n    conditions = \"1=0\"\r\nconditions\r\n",
  "script_type": "Permission Query"
 }
]